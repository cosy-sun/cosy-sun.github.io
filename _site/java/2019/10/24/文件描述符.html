<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>cosy-sun</title>
	<link rel="icon" href="/assets/images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css">
    <![endif]-->
    <!--[if lt IE 9]>
       <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
       <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
    <![endif]-->
    <link href="/assets/css/main.css" rel="stylesheet" type="text/css">


</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-custom navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">cosy-sun</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    
                    <li class="active"><a href="/">Home</a></li>
                    <li class="active"><a href="/archive.html">Archive</a></li>
                    <li class="active"><a href="/categories.html">Categories</a></li>
                    <li class="active"><a href="/tags.html">Tags</a></li>
                    <li class="active"><a href="/about.html">about</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>


<div class="wrap">
    <div class="container container-left">
        <div class="row">
            <div class="col-md-3 hidden-xs">
                
<div class="sidebar well">
    <header class="sidebar-header" role="banner">
        <a href="/">
            <img src="/assets/images/xixia.gif" class="img-circle" />
        </a>
        <!--
        <h3 class="title">
        <a href="/"></a>
        </h3>
        -->
    </header>
    <div class="text-center">
        cosy-sun
    </div>
</div>


<div class="sidebar well">
    <h1>Top</h1>
    <ul>
        
            
                
            
                
            
                
                    <li><a href="/linux/2020/05/20/vbox%E6%90%AD%E5%BB%BAubuntu%E7%8E%AF%E5%A2%83.html">vbox</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/git/2019/10/24/git.html">git</a></li>
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/java/2019/10/24/regexps.html">正则</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/java/2019/10/28/jdk1.8.html">jdk1.8</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
    </ul>
</div>


<div class="sidebar well">
    <h1>Last Posts</h1>
    <ul>
        
          <li><a href="/linux/2020/06/20/docker.html">docker</a></li>
        
          <li><a href="/java/2020/06/19/netty.html">netty</a></li>
        
          <li><a href="/linux/2020/05/20/vbox%E6%90%AD%E5%BB%BAubuntu%E7%8E%AF%E5%A2%83.html">vbox</a></li>
        
          <li><a href="/hadoop/2019/10/29/hadoop.html">hadoop</a></li>
        
          <li><a href="/java/2019/10/28/jdk1.8.html">jdk1.8</a></li>
        
    </ul>
</div>

<div class="sidebar well">
    
<h1>Links</h1>
<ul>
  <!-- <li><a href="#">One</a></li>
  <li><a href="#">Two</a></li>
  <li><a href="#">Three</a></li>
  <li><a href="#">Four</a></li> -->
  
  <li>
    <a href="https://github.com/cosy-sun/java">
      java
    </a>
  </li> 
  
  <li>
    <a href="https://github.com/cosy-sun/python">
      python
    </a>
  </li> 
  
  <li>
    <a href="https://github.com/cosy-sun/c">
      c
    </a>
  </li> 
  
  <li>
    <a href="https://github.com/cosy-sun/cosy-sun.github.io">
      blog
    </a>
  </li> 
  
</ul>

</div>

            </div>
            <div class="col-md-9">
                
<div class="well article">
        <h2><a href="/java/2019/10/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6.html">文件描述符</a></h2>
        <span class="post-date">
            
            October-24-2019
        </span>
        <hr style="border-top:1px solid #28323C;"/>
    
    <div class="post-content">
    <ul>
  <li>文件描述符</li>
</ul>

<p>    在linux系统中,一切都是文件,比如c++源文件,视频文件,shell脚本, 可执行文件,包括键盘,鼠标,显示器等硬件设备,</p>

<p>    一个进程可以打开成百上千的文件,为了表示和区分已经打开的文件,linux会给每个文件分配一个编号,,这个编号就是一个整数,被称为文件描述符</p>

<p>    一个linux进程启动后,会在内核中创建一个pcb控制块,pcb内部有一个文件描述符表,记录着当前进程所有可用的文件描述符,也就是当前进程打开的文件,</p>

<p>    进程启动后要占用内存,一部分分配给了文件描述符,另一部分给了打开文件表和i-node表</p>

<p>    打开文件表和i-node是系统级的, 之后一个, 文件描述符表每个进程都由一个</p>

<p>    通过文件描述符表可以找到文件指针,通过文件指针,进入打开文件表,该表存储了一下信息: 文件偏移量,状态模式,i-node表指针;通过i-node表指针进入i-node表,i-node表中存储了一下信息: 文件类型, 文件大小, 时间戳, 文件锁</p>

<ul>
  <li>
    <p>同一个进程的不同文件描述符可以指向同一个文件,</p>
  </li>
  <li>
    <p>不同进程可以拥有相同的文件描述符,</p>
  </li>
  <li>
    <p>不同进程的同一个文件描述符可以指向不同的文件(除了0, 1, 2这三个特殊的文件)</p>
  </li>
  <li>
    <p>不同进程的不同文件描述符也可以指向同一个文件</p>
  </li>
</ul>

<p>    当linux运行一个程序时, 它打开三个相应的文件描述符,分表时0, 1, 2 ,
对应的时标准输入, 标准输出, 标准错误输出</p>

<h1 id="javanio中的文件描述符">javanio中的文件描述符</h1>

<ul>
  <li>
    <p>Java中的FileDescriptor可以被用来表示开放文件和套接字</p>

    <p>创建一个socket并通过文件描述符放到serversocketchannel中</p>
  </li>
  <li>
    <p>serversocketchannel的初始化,通过bind()将文件描述符和本地ip地址和制定的port绑定,同时监听这个文件描述符</p>
  </li>
  <li>
    <p>selector创建, 创建一对管道,一个输入管道,一个输出管道,在创建过程中,有通过socket验证是否能正常传输,也即是用来唤醒selector工作的</p>
  </li>
  <li>
    <p>事件注册,将selectionkey的socketchannel的文件描述符放到pollarray中</p>
  </li>
  <li>
    <p>通信,核心方法private native int poll0(long pollAddreee, int numfds, int[] readfds, int[] writefds, int[] exceptfds, long timeout),</p>

    <ul>
      <li>
        <p>实现思路是调用c中的select方法,这里的select方法调用的是内核中的sys_select, sys_select首先将第2,3,4个参数指向的fd_set拷贝到尼日河,然后对每个set的描述符调用进行poll,并记录在临时结果中, 如果有事件发生, select会将临时结果写道用户空间并返回,当轮询一编后没有任何事件发生,如果制定了超时时间, select会水淼到超市,睡眠结束之后在轮询一遍, 并将临时结果写道用户空间,然后返回,</p>
      </li>
      <li>
        <p>这里的select就是轮询pollarray中的fd,如果有事件发生, 收集所有发生的事件,然后返回,</p>
      </li>
    </ul>
  </li>
</ul>

    <hr style="border-top:1px solid #28323C;"/>

    <!-- tags and categories under post -->
    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-folder-open"></i></li>
      
      
         
            <li class="icon-style"><a href="/categories.html">
                java <span>(12)</span>
                
            </a></li>
        
      
    </ul>
      

    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-tags"></i></li>
      
      
         
            <li class="icon-style">
                <a href="/tags.html">
                java <span>(12)</span>
                
                </a>
            </li>
        
      
      
    </ul>
      

    </div>
    
</div>
<div class="pagination">
    
    <a class="btn btn-default" href="/java/2019/10/24/%E7%AE%97%E6%B3%95.html" class="next">Next</a>
    
    
    <a class="btn btn-default" href="/java/2019/10/24/xml%E4%B8%8Ejson%E4%BB%8B%E7%BB%8D%E4%B8%8E%E8%A7%A3%E6%9E%90.html" class="previous">Pre</a>
    
</div>
            </div>
        </div>
    </div>

    
<div class="footer">
    <p>&copy;2021 cosy-sun     
            
                <a href="https://github.com/cosy-sun">
                Github
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/cosy-sun/cosy-sun.github.io">
                blog
                </a>
                <!-- not the last, output a ',' -->
                
            
    </p>
</div>

<!-- 
    

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
  </script>

 
-->

</body>
</html>

</div>