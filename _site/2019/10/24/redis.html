<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Redis | cosy-sun</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Redis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="##redis 概念 1. 完全开源免费的 2. 内存数据库 3. 特点 支持数据的持久化，可以把内存中的数据持久化到磁盘中，重启的时候加载使用。 不仅支持key-value类型的数据，同时也支持list、set、zset、hash等数据的存储。 支持数据的备份 优势" />
<meta property="og:description" content="##redis 概念 1. 完全开源免费的 2. 内存数据库 3. 特点 支持数据的持久化，可以把内存中的数据持久化到磁盘中，重启的时候加载使用。 不仅支持key-value类型的数据，同时也支持list、set、zset、hash等数据的存储。 支持数据的备份 优势" />
<link rel="canonical" href="/2019/10/24/redis.html" />
<meta property="og:url" content="/2019/10/24/redis.html" />
<meta property="og:site_name" content="cosy-sun" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-24T00:00:00+08:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"/2019/10/24/redis.html"},"url":"/2019/10/24/redis.html","dateModified":"2019-10-24T00:00:00+08:00","datePublished":"2019-10-24T00:00:00+08:00","headline":"Redis","description":"##redis 概念 1. 完全开源免费的 2. 内存数据库 3. 特点 支持数据的持久化，可以把内存中的数据持久化到磁盘中，重启的时候加载使用。 不仅支持key-value类型的数据，同时也支持list、set、zset、hash等数据的存储。 支持数据的备份 优势","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
  <link rel="icon" type= "image/x-icon" href="../image/szh.ico"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="cosy-sun" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">cosy-sun</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Redis</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-10-24T00:00:00+08:00" itemprop="datePublished">Oct 24, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>##redis</p>
<ul>
  <li>
    <p>概念</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    1. 完全开源免费的
    2. 内存数据库
    3. 特点
   
        支持数据的持久化，可以把内存中的数据持久化到磁盘中，重启的时候加载使用。
   
        不仅支持key-value类型的数据，同时也支持list、set、zset、hash等数据的存储。  
  
        支持数据的备份
</code></pre></div>    </div>
  </li>
  <li>
    <p>优势</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1. 性能高

  2. 丰富的数据类型

  3. 原子操作
</code></pre></div>    </div>
  </li>
  <li>
    <p>安装</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   1. 创建一个文件夹（路径中不出现中文字符）
   2. 解压压缩包到创建的文件夹
   3. 安装完成
</code></pre></div>    </div>
  </li>
  <li>
    <p>启动</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1. 启动服务器
      cmd中运行redis-server.exe redis.windows.conf，启动成功后会看到启动图案和启动信息：redis版本和监听端口等信息。
      在使用redis服务过程中不能关闭此cmd窗口，否则整个服务区也将关闭。
  2.启动客户端
      重新开启一个cmd窗口，
      切换到redis目录下，
      运行redis-cli.exe -h 127.0.0.1 -p6379
      或者redis-cli.exe(默认的端口和ip)
  3.redis本身不区分大小写，但是key值是区分大小写的
</code></pre></div>    </div>
  </li>
  <li>
    <p>redis配置参数的介绍(redis.windows.conf)</p>

    <ul>
      <li>
        <p>绑定的主机地址</p>

        <p><code class="highlighter-rouge">bind</code></p>
      </li>
      <li>
        <p>绑定的端口号</p>
      </li>
    </ul>

    <p><code class="highlighter-rouge">port</code></p>
    <ul>
      <li>
        <p>客户端闲置多长时间内关闭</p>

        <p><code class="highlighter-rouge">timeout</code></p>

        <p>默认为0 关闭此功能</p>
      </li>
      <li>
        <p>数据库的数量，默认数据库的index从0开始，可以使用<code class="highlighter-rouge">select[dbid]</code>连接指定的数据库</p>

        <p><code class="highlighter-rouge">databases 16</code></p>
      </li>
      <li>
        <p>指定多长时间之内，有多少次操作就将数据同步到数据文件</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> // 900秒内有一个更改
 save 900 1
        
 // 300秒内有15个更改
 save 300 10
		
 // 60秒内有10000个更改
 save 60 10000
</code></pre></div>        </div>
      </li>
      <li>指定本地数据库在存储时是否压缩<code class="highlighter-rouge">rdbcompression yes</code>lzf压缩</li>
      <li>redus的本地数据库文件名</li>
    </ul>

    <p><code class="highlighter-rouge">dbfilename dump.rdb</code></p>
    <ul>
      <li>
        <p>设置redis连接密码，如果配置了密码，在连接数据库时需要使用密码</p>

        <p><code class="highlighter-rouge">requirepass 123456</code></p>

        <p>默认redis是没有密码的</p>
      </li>
      <li>
        <p>最大客户连接数</p>

        <p><code class="highlighter-rouge">maxclients 128</code></p>
      </li>
      <li>
        <p>最大内存限制</p>

        <p><code class="highlighter-rouge">maxmemory</code></p>
      </li>
      <li>
        <p>每次更新操作后是否进行日志记录</p>

        <p><code class="highlighter-rouge">appendonly</code></p>

        <p>redis在启动时会把数据以异步的方式写入到磁盘中，如果不开启，在断电之后，可能会丢失数据，</p>

        <p>因为redis本身是按照上面的save保存条件来进行同步的，某一段时间内的数据只存在于内存中。</p>
      </li>
    </ul>
  </li>
  <li>
    <p>redis支持的数据类型</p>

    <p><em><strong>所有类型数据的删除操作都是</strong>del key</em></p>

    <ul>
      <li>
        <p>string字符串</p>

        <p>redis中最基本的数据类型  <br />
最大存储512MB</p>
      </li>
      <li>
        <p>hash（哈希）</p>

        <p>键值对</p>

        <p>hmset key （value）field value field value`</p>

        <p><code class="highlighter-rouge">hmset tom username tom password 123</code></p>

        <p>hgetall key</p>

        <p><code class="highlighter-rouge">hgetall tom</code></p>

        <p>hget key field</p>

        <p><code class="highlighter-rouge">hget tom username</code></p>
      </li>
      <li>
        <p>list(列表)</p>

        <p>lpush key value value</p>

        <p><code class="highlighter-rouge">lpush list01 sunzhenhua</code></p>

        <p><code class="highlighter-rouge">lpush list01 yangyulong</code></p>

        <p><code class="highlighter-rouge">lpush list01 niulihang</code></p>

        <p><code class="highlighter-rouge">lpush list01 chenguo</code></p>

        <p>lrange key start stop</p>

        <p><code class="highlighter-rouge">lrange list01 0 1</code></p>

        <p><code class="highlighter-rouge">lrange list01 0 -1</code></p>

        <p>lrem key count value</p>

        <p><code class="highlighter-rouge">lrem list01 0 niulihang</code></p>
      </li>
      <li>
        <p>set</p>

        <p><strong><em>string类型的无序集合</em></strong></p>

        <p>sadd key member</p>

        <p><code class="highlighter-rouge">sadd set01 szh 1 hello sunzhenhua</code></p>

        <p>smembers key</p>

        <p><code class="highlighter-rouge">smembers set01</code></p>

        <p>srem key member</p>

        <p><code class="highlighter-rouge">srem set szh</code></p>
      </li>
      <li>
        <p>zset</p>

        <p><strong><em>有序集合</em></strong></p>

        <p>zadd key score value score value</p>

        <p><code class="highlighter-rouge">zadd zset01 0 hello 1 szh  2 ssef </code></p>

        <p>zrange key start stop</p>

        <p><code class="highlighter-rouge">zrange zset01 0 -1</code></p>

        <p>zrem key  member</p>

        <p><code class="highlighter-rouge">zrem zset01 hello</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>redis中对key的操作</p>

    <ul>
      <li>
        <p>查看所有的key值</p>

        <p><code class="highlighter-rouge">keys *</code></p>
      </li>
      <li>
        <p>删除存在的key</p>

        <p><code class="highlighter-rouge">del key</code></p>
      </li>
      <li>
        <p>判断指定的key是否存在</p>

        <p><code class="highlighter-rouge">exists key</code></p>
      </li>
      <li>
        <p>expire设置key的过期时间</p>

        <p><code class="highlighter-rouge">expire key seconds</code></p>
      </li>
      <li>
        <p>移除key的过期时间</p>

        <p><code class="highlighter-rouge">persist key </code></p>
      </li>
      <li>
        <p>查看剩余key的过期时间</p>

        <p><code class="highlighter-rouge">ttl key</code></p>
      </li>
      <li>
        <p>随机返回一个key名称</p>

        <p><code class="highlighter-rouge">randomkey</code></p>
      </li>
      <li>
        <p>查看key的存储的值类型</p>

        <p><code class="highlighter-rouge">type key</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>redis中的事务</p>

    <ul>
      <li>
        <p>redis不支持事务回滚，可以保持简洁和快速</p>
      </li>
      <li>multi（相当于开启事务）和exec（相当于执行事务）命令</li>
      <li>
        <p>取消事务</p>

        <p><code class="highlighter-rouge">discard</code></p>
      </li>
      <li>
        <p>成功</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6397&gt; multi
ok
127.0.0.1:6397&gt; <span class="nb">set </span>name tom
QUEUED
127.0.0.1:6397&gt; <span class="nb">set </span>age 20
QUEUED
127.0.0.1:6397&gt; <span class="nb">set </span>dob 2016-11-11
QUEUED
127.0.0.1:6397&gt; <span class="nb">exec
</span>1<span class="o">)</span>OK
2<span class="o">)</span>OK
3<span class="o">)</span>OK
</code></pre></div>        </div>
      </li>
      <li>
        <p>失败（语法错误）</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; multi
OK
127.0.0.1:6379&gt; <span class="nb">set </span>name tom
QUEUED
127.0.0.1:6379&gt; <span class="nb">set </span>age 20
QUEUED
127.0.0.1:6379&gt; seta dob 2016-11-11
<span class="o">(</span>error<span class="o">)</span> ERR unknown <span class="nb">command</span> <span class="s1">'seta'</span>
127.0.0.1:6379&gt; <span class="nb">exec</span>
<span class="o">(</span>error<span class="o">)</span> EXECABORT Transaction discarded          because of previous errors.
127.0.0.1:6379&gt; get name
<span class="o">(</span>nil<span class="o">)</span>
127.0.0.1:6379&gt; get age
<span class="o">(</span>nil<span class="o">)</span>
127.0.0.1:6379&gt; get dob
<span class="o">(</span>nil<span class="o">)</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>失败（运行错误）</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1:6379&gt; multi
  OK
  127.0.0.1:6379&gt; set name tom
  QUEUED
  127.0.0.1:6379&gt; set age 20
  QUEUED
  127.0.0.1:6379&gt; hget name age
  QUEUED
  127.0.0.1:6379&gt; exec
  1) OK
  2) OK
  3) (error) WRONGTYPE Operation against a key holding the wrong kind of value
  127.0.0.1:6379&gt; get name
  "tom"
  127.0.0.1:6379&gt; get age
  "20"
</code></pre></div>        </div>
      </li>
      <li>
        <p>redis事务错误：
    + 语法错误</p>

        <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    如果碰到语法错误，在2.6.5之前的版本整个事务会忽略错误的命令
    在之后的版本中会忽略整个事务中的命令
+ 运行错误


    运行错误表示在事务执行过程中某一条命令出现错误，其他事务仍然会执行。
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>redis持久化</p>

    <ul>
      <li>rdb</li>
    </ul>

    <p>####redis通过快照完成持久化的</p>

    <p>通过一段时间，redis会把内存中的数据存储在数据库中，dump.rdb文件中</p>

    <p>快照的过程：</p>

    <p>1.redis使用fork函数先把当前进程中的数据复制一份</p>

    <p>2.父进程继续接受来自客户端的数据，子进程开始将内存中的数据写入硬盘中的临时文件中。</p>

    <p>3.当临时文件写入完成之后，会替换之前存在的dump.rdb文件，一次完成。</p>

    <p>在任何时候rdb文件都是完整的，在中间的过程中不会修改文件，只有完成之后才会修改文件。</p>

    <p>####也可以手动执行快照</p>

    <p><code class="highlighter-rouge">save</code>或者<code class="highlighter-rouge">bgsave</code></p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> save阻塞其他请求

 bgsave在后台进行快照。
</code></pre></div>    </div>

    <ul>
      <li>aof</li>
    </ul>

    <p>aof是通过日志方式进行的。</p>

    <p>通过appendonly开启aof持久化方式。</p>

    <p>通过appendfsync 设置命令同步的时机</p>

    <p><code class="highlighter-rouge">always</code>每次都会执行</p>

    <p><code class="highlighter-rouge">everysec</code>默认每秒执行一次</p>

    <p><code class="highlighter-rouge">no</code>不主动执行，30秒执行一次</p>

    <p>通过appendfile 设置保存的文件名</p>

    <p>####手动执行aof</p>

    <p>bgrewriteaof</p>
  </li>
  <li>
    <p>redis中的config命令</p>

    <p>动态设置参数，服务器重启之后就失效了。</p>

    <p>config get * 可以查看所有使用config set设置的参数</p>
  </li>
  <li>
    <p>redis的发布订阅模式（消息通信）o</p>

    <p><code class="highlighter-rouge">publish channel message</code>
   发布消息在某个信道上channel 消息内容是message</p>

    <p><code class="highlighter-rouge">subscribe channel ...</code>
  另外开启一个客户端，在这个客户端上面订阅来自某个信道channel的消息，</p>

    <p><code class="highlighter-rouge">unsubscribe channel</code>取消订阅</p>
  </li>
</ul>


  </div><a class="u-url" href="/2019/10/24/redis.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <!--<h2 class="footer-heading">cosy-sun</h2>-->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cosy-sun</li><li><a class="u-email" href="mailto:737387998@qq.com">737387998@qq.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/cosy-sun"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">cosy-sun</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>孙振华的博客</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
